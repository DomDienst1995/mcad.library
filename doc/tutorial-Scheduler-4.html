<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>Tutorial: Scheduler-4 - Documentation</title>

    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="https://code.ionicframework.com/ionicons/2.0.1/css/ionicons.min.css">
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>
<body>

<input type="checkbox" id="nav-trigger" class="nav-trigger" />
<label for="nav-trigger" class="navicon-button x">
  <div class="navicon"></div>
</label>

<label for="nav-trigger" class="overlay"></label>

<nav>
    <h2><a href="index.html">Home</a></h2><h3 class="globals"><a href="global.html">Global</a></h3><h3>Classes</h3><ul><li><a href="BufferLoader.html">BufferLoader</a><ul class='methods'><li data-type='method'><a href="BufferLoader.html#loadBuffer">loadBuffer</a></li><li data-type='method'><a href="BufferLoader.html#loadBufferList">loadBufferList</a></li></ul></li><li><a href="Mseg.html">Mseg</a><ul class='methods'><li data-type='method'><a href="Mseg.html#addRelease">addRelease</a></li><li data-type='method'><a href="Mseg.html#addStage">addStage</a></li><li data-type='method'><a href="Mseg.html#durationOfRelease">durationOfRelease</a></li><li data-type='method'><a href="Mseg.html#noteOff">noteOff</a></li><li data-type='method'><a href="Mseg.html#noteOn">noteOn</a></li><li data-type='method'><a href="Mseg.html#noteOnAndOff">noteOnAndOff</a></li></ul></li><li><a href="Rotary.html">Rotary</a><ul class='methods'><li data-type='method'><a href="Rotary.html#getNormValue">getNormValue</a></li><li data-type='method'><a href="Rotary.html#getParamValue">getParamValue</a></li><li data-type='method'><a href="Rotary.html#setNormValue">setNormValue</a></li><li data-type='method'><a href="Rotary.html#setParamValue">setParamValue</a></li></ul></li><li><a href="Scheduler.html">Scheduler</a><ul class='methods'><li data-type='method'><a href="Scheduler.html#clampStepStamp">clampStepStamp</a></li><li data-type='method'><a href="Scheduler.html#cloneStepStamp">cloneStepStamp</a></li><li data-type='method'><a href="Scheduler.html#cloneTimeStamp">cloneTimeStamp</a></li><li data-type='method'><a href="Scheduler.html#createStepStamp">createStepStamp</a></li><li data-type='method'><a href="Scheduler.html#createTimeStamp">createTimeStamp</a></li><li data-type='method'><a href="Scheduler.html#getStepLength">getStepLength</a></li><li data-type='method'><a href="Scheduler.html#offsetStepStamp">offsetStepStamp</a></li><li data-type='method'><a href="Scheduler.html#start">start</a></li><li data-type='method'><a href="Scheduler.html#stop">stop</a></li></ul></li></ul><h3>Namespaces</h3><ul><li><a href="mcad.html">mcad</a><ul class='methods'><li data-type='method'><a href="mcad.html#.logToUnsignedNorm">logToUnsignedNorm</a></li><li data-type='method'><a href="mcad.html#.midiNoteToHz">midiNoteToHz</a></li><li data-type='method'><a href="mcad.html#.paramToSignedNorm">paramToSignedNorm</a></li><li data-type='method'><a href="mcad.html#.paramToUnsignedNorm">paramToUnsignedNorm</a></li><li data-type='method'><a href="mcad.html#.signedNormToParam">signedNormToParam</a></li><li data-type='method'><a href="mcad.html#.signedNtoUnsignedN">signedNtoUnsignedN</a></li><li data-type='method'><a href="mcad.html#.unsignedNormToLog">unsignedNormToLog</a></li><li data-type='method'><a href="mcad.html#.unsignedNormToParam">unsignedNormToParam</a></li><li data-type='method'><a href="mcad.html#.unsignedNtoSignedN">unsignedNtoSignedN</a></li></ul></li></ul><h3>Tutorials</h3><ul><li><a href="tutorial-Scheduler-1.html">Scheduler-1</a></li><li><a href="tutorial-Scheduler-2.html">Scheduler-2</a></li><li><a href="tutorial-Scheduler-3.html">Scheduler-3</a></li><li><a href="tutorial-Scheduler-4.html">Scheduler-4</a></li><li><a href="tutorial-Scheduler-5.html">Scheduler-5</a></li></ul>
</nav>

<div id="main">
    
    <h1 class="page-title">Tutorial: Scheduler-4</h1>
    

    <section>

<header>
    

    <h2>Scheduler-4</h2>
</header>

<article>
    <style>

h3 {
	font-size: 1.1em;
}

</style>

<p>This tutorial demonstrates the handling of the <code>onTween</code> event by attaching an event handler and using the tweening information contained within the event to perform smooth animations.</p>

<p>To run this program, copy the code in Listing 1 into a new HTML file and copy the MCAD Pattern Scheduler and jQuery javascript files into the same folder. The program will produce output in the form of a metronome ticking for each 1/16<sup>th</sup> note whilst modifying tabular data in real-time in response to events and performing smooth pattern animations. Opening up the console window (Ctl-Shift-J in Google Chrome) will produce log out put as in Figure 1 below.</p>

<h3>Code Breakdown</h3>

<p>With this example, the scheduler is sending out the pulses as described in the previous tutorial as well as a smooth, continuous pulse in the <code>[0.0,1.0]</code> range from the beginning (0.0) and until the end of the pattern (1.0).</p>

<p>The <code>onTween</code> event handler uses the <code>tween</code> value to modulate the colour of a circle from black to red as the playback position moves smoothly from the beginning to the end of the pattern. It does this by taking the event's <code>tween</code> value and mapping it to the <code>[0,255]</code> range by multiplying the <code>tween</code> value by 255 and truncating (removing the fractional part) the result. This result is then used as the <code>r</code> component of the CSS <code>rgba</code> colour value of the element's <code>background-color</code> property.</p>

<p>The pattern position paragraph element is likewise modified by the <code>tween</code> value by using jQuery to set the element's text to the <code>tween</code> percentage value. This percentage value is calculated by multiplying the <code>tween</code> value by 100 and truncating the result.</p>

<h2>Code Listing</h2>

<pre class="prettyprint">
&lt;!doctype html&gt;
&lt;html&gt;
	&lt;head&gt;
		&lt;meta charset=&quot;utf-8&quot;&gt;
		&lt;!-- Include the MCAD Sampler class (make sure to copy to your project folder) --&gt;
		&lt;script src=&quot;mcad.pattern.scheduler.v1-0.js&quot;&gt;&lt;/script&gt;
		&lt;!-- Include the jQuery library files --&gt;
		&lt;link rel=&quot;stylesheet&quot; href=&quot;jquery-ui.min.css&quot;&gt;
		&lt;script src=&quot;external/jquery/jquery.js&quot;&gt;&lt;/script&gt;
		&lt;script src=&quot;jquery-ui.min.js&quot;&gt;&lt;/script&gt;
		&lt;!-- Add some basic styling to make the page look prettier --&gt;
		&lt;style&gt;
			body {
				background-color: rgb(245, 245, 245);
				color: rgb(121, 121, 121);
				font-family: 'Droid Sans', Arial, sans-serif;
				font-size: 1em;
			}
			
			h1 {
				text-align: center;
			}
			
			.main {
				width: 620px;
				margin: 0 auto; 
			}
			
			table {
				width: 620px;
			}
			
			th, td {
				width: 33.334%;
				text-align: center; 
				font-family: 'Droid Sans', Arial, sans-serif;
			}
			
			th {
				background-color: #000000; 
				color: #ffffff;
			}
			
			td {
				color: #000000; 
				background-color: #ffffff;
			}
			
			#tween {
				text-align: center;
			}
			
			#tweenAnim {
				background-color: black;
				width: 100px;
				height: 100px;
				border-radius: 50%;
				margin: 0 auto;
			}
			
		&lt;/style&gt;
		&lt;!-- Page title (appears in browser/tab titlebar) --&gt;
		&lt;title&gt;MCAD Scheduler Tutorial 4&lt;/title&gt;
	&lt;/head&gt;
	&lt;body&gt;
		&lt;!-- Our HTML goes here --&gt;
		&lt;div class=&quot;main&quot;&gt;
		&lt;h1&gt;Handling onTween Events&lt;/h1&gt;
		&lt;p&gt;Creates and initiates a scheduler with a tempo of 60 bpm in 4/4 time with 1/16&lt;sup&gt;th&lt;/sup&gt; note steps.&lt;/p&gt;
		&lt;p&gt;If running in Google Chrome, open the Developer Tools (Ctl-Shift-J) and view the log output.&lt;/p&gt;
		&lt;p&gt;In this example, the scheduler is sending out three pulses, queue, animation and tween, in the form of an events. The queue event is used to queue up a step for future playback, the animation event is used to animate a step once the pattern playback position reaches that step in real-time and the tween event is used to perform smooth animations across the duration of the pattern.&lt;/p&gt;
		&lt;p&gt;The table below has its data modified in response to the queue and animation events. Note that the queue and animation positions are out of sync. This is because the queue position may well be in the future whereas the animation position always represents the real-time playback time of a given step.&lt;/p&gt;
		&lt;p&gt;The pattern position and circle elements below the table are being modified smoothly and independent of step playback, with the beginning of the pattern representing tween position &lt;b&gt;0.0&lt;/b&gt; and the end of the pattern representing tween position &lt;b&gt;1.0.&lt;/b&gt;&lt;/p&gt;
		
		&lt;!-- Table displaying the onQueue and onAnim event data --&gt;
		&lt;table border=&quot;1&quot; align=&quot;center&quot; cellpadding=&quot;5&quot; cellspacing=&quot;0&quot;&gt;
			&lt;tbody&gt;
				&lt;tr&gt;
					&lt;th&gt;&lt;strong&gt;Stamp Property&lt;/strong&gt;&lt;/th&gt;
					&lt;th&gt;&lt;strong&gt;onQueue Event&lt;/strong&gt;&lt;/th&gt;
					&lt;th&gt;&lt;strong&gt;onAnim Event&lt;/strong&gt;&lt;/th&gt;
				&lt;/tr&gt;
				&lt;tr&gt;
					&lt;td&gt;Bar&lt;/td&gt;
					&lt;td id=&quot;qBar&quot;&gt;&lt;/td&gt;
					&lt;td id=&quot;aBar&quot;&gt;&lt;/td&gt;
				&lt;/tr&gt;
				&lt;tr&gt;
					&lt;td&gt;Beat&lt;/td&gt;
					&lt;td id=&quot;qBeat&quot;&gt;&lt;/td&gt;
					&lt;td id=&quot;aBeat&quot;&gt;&lt;/td&gt;
				&lt;/tr&gt;
				&lt;tr&gt;
					&lt;td&gt;Step&lt;/td&gt;
					&lt;td id=&quot;qStep&quot;&gt;&lt;/td&gt;
					&lt;td id=&quot;aStep&quot;&gt;&lt;/td&gt;
				&lt;/tr&gt;
				&lt;tr&gt;
					&lt;td&gt;Pattern Position&lt;/td&gt;
					&lt;td id=&quot;qPattern&quot;&gt;&lt;/td&gt;
					&lt;td id=&quot;aPattern&quot;&gt;&lt;/td&gt;
				&lt;/tr&gt;
				&lt;tr&gt;
					&lt;td&gt;GUID&lt;/td&gt;
					&lt;td id=&quot;qGUID&quot;&gt;&lt;/td&gt;
					&lt;td id=&quot;aGUID&quot;&gt;&lt;/td&gt;
				&lt;/tr&gt;
			&lt;/tbody&gt;
		&lt;/table&gt;
		&lt;!-- Pattern position element --&gt;
		&lt;p id=&quot;tween&quot;&gt;Pattern position: 0%&lt;/p&gt;
		&lt;!-- Animation element (circle from black to red) --&gt;
		&lt;div id=&quot;tweenAnim&quot;&gt;&amp;nbsp&lt;/div&gt;
		&lt;/div&gt;
		&lt;script&gt;
			
			// Event handler for scheduler's onQueue events
			function playStep(step) {

				// Create an oscillator node and connect it to the context's output
				var oscillator = context.createOscillator();
				oscillator.connect(context.destination);

				// Queue osillator to start playback on step's playback time
				oscillator.start(step.time.swing);

				// If the step number has a remainder when divided by 4 (modulus operator: %), play 400 hz
				// Otherwise (on beat), play 800 hz
				if(step.stamp.step % 4)oscillator.frequency.value = 400;
				else oscillator.frequency.value = 800;

				// Queue oscillator to stop playback 100ms after step's playback time
				oscillator.stop(step.time.swing + 0.1); 
				
				// Modify the onQueue column in the event table to display this event's stamp information
				$(&quot;#qBar&quot;).text(step.stamp.bar);
				$(&quot;#qBeat&quot;).text(step.stamp.beat);
				$(&quot;#qStep&quot;).text(step.stamp.step);
				$(&quot;#qPattern&quot;).text(step.stamp.patternPos);
				$(&quot;#qGUID&quot;).text(step.stamp.guid);
			}
			
			// Event handler for scheduler's onAnim events
			function animateStep(currentStep, lastStep) {

				// Modify the onAnim column in the event table to display this event's stamp information
				$(&quot;#aBar&quot;).text(currentStep.bar);
				$(&quot;#aBeat&quot;).text(currentStep.beat);
				$(&quot;#aStep&quot;).text(currentStep.step);
				$(&quot;#aPattern&quot;).text(currentStep.patternPos);
				$(&quot;#aGUID&quot;).text(currentStep.guid);
			}
			
			// Event handler for scheduler's onTween events
			function tweenStep(tween) {

				// Modify the tween paragraph to display the current (rounded) tween value as a percentage
				$(&quot;#tween&quot;).text(&quot;Pattern position: &quot; + Math.trunc(tween * 100) + &quot;%&quot;)
				
				// Smoothly animate the tweenAnim element's background colour from black (start of pattern) to red (end of pattern)
				$(&quot;#tweenAnim&quot;).css(&quot;background-color&quot;, &quot;rgba(&quot; + Math.trunc(tween * 255) + &quot;,0,0,255&quot;);
			}
		
			// Attempt to create a Web Audio context, otherwise fallback on the older Webkit Audio context
			var context = new (window.AudioContext || window.webkitAudioContext)();
			
			// Create a scheduler with a tempo of 60 bpm in 4/4 time with 1/16th note steps and queue, animation and tween event handlers
			var scheduler = new Scheduler(context, {tempo: 60, onQueue: playStep, onAnim: animateStep, onTween: tweenStep, scheduleAheadTime: 0.5, lookAheadTime: 0.25});
			
			// Initiate the scheduler's timing pulses
			scheduler.start();

		&lt;/script&gt;
	&lt;/body&gt;
&lt;/html&gt;
</pre>
Listing 1. - HTML listing for onQueue, onAnim and onTween event handling scheduler.

<h2>Example Output</h2>

<figure style="margin-left: 0;">
  <img src="Scheduler-4-F1.png" style="margin-top: 15px; border:1px solid #aaaaaa">
  <figcaption>Figure 1. - The onQueue, onAnim and onTween event handling scheduler application with console output window.</figcaption>
</figure>


</article>

</section>

</div>

<br class="clear">

<footer>
    Documentation generated at Wed Nov 02 2016 00:07:49 GMT+0000 (GMT Standard Time)
</footer>

<script>prettyPrint();</script>
<script src="scripts/linenumber.js"></script>
</body>
</html>