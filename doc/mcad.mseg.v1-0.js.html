<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>mcad.mseg.v1-0.js - Documentation</title>

    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="https://code.ionicframework.com/ionicons/2.0.1/css/ionicons.min.css">
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>
<body>

<input type="checkbox" id="nav-trigger" class="nav-trigger" />
<label for="nav-trigger" class="navicon-button x">
  <div class="navicon"></div>
</label>

<label for="nav-trigger" class="overlay"></label>

<nav>
    <h2><a href="index.html">Home</a></h2><h3 class="globals"><a href="global.html">Global</a></h3><h3>Classes</h3><ul><li><a href="BufferLoader.html">BufferLoader</a><ul class='methods'><li data-type='method'><a href="BufferLoader.html#loadBuffer">loadBuffer</a></li><li data-type='method'><a href="BufferLoader.html#loadBufferList">loadBufferList</a></li></ul></li><li><a href="Mseg.html">Mseg</a><ul class='methods'><li data-type='method'><a href="Mseg.html#addRelease">addRelease</a></li><li data-type='method'><a href="Mseg.html#addStage">addStage</a></li><li data-type='method'><a href="Mseg.html#noteOff">noteOff</a></li><li data-type='method'><a href="Mseg.html#noteOn">noteOn</a></li></ul></li><li><a href="Rotary.html">Rotary</a><ul class='methods'><li data-type='method'><a href="Rotary.html#getNormValue">getNormValue</a></li><li data-type='method'><a href="Rotary.html#getParamValue">getParamValue</a></li><li data-type='method'><a href="Rotary.html#setNormValue">setNormValue</a></li><li data-type='method'><a href="Rotary.html#setParamValue">setParamValue</a></li></ul></li><li><a href="Scheduler.html">Scheduler</a><ul class='methods'><li data-type='method'><a href="Scheduler.html#clampStepStamp">clampStepStamp</a></li><li data-type='method'><a href="Scheduler.html#cloneStepStamp">cloneStepStamp</a></li><li data-type='method'><a href="Scheduler.html#cloneTimeStamp">cloneTimeStamp</a></li><li data-type='method'><a href="Scheduler.html#createStepStamp">createStepStamp</a></li><li data-type='method'><a href="Scheduler.html#createTimeStamp">createTimeStamp</a></li><li data-type='method'><a href="Scheduler.html#getStepLength">getStepLength</a></li><li data-type='method'><a href="Scheduler.html#offsetStepStamp">offsetStepStamp</a></li><li data-type='method'><a href="Scheduler.html#start">start</a></li><li data-type='method'><a href="Scheduler.html#stop">stop</a></li></ul></li></ul><h3>Namespaces</h3><ul><li><a href="mcad.html">mcad</a><ul class='methods'><li data-type='method'><a href="mcad.html#.paramToSignedNorm">paramToSignedNorm</a></li><li data-type='method'><a href="mcad.html#.paramToUnsignedNorm">paramToUnsignedNorm</a></li><li data-type='method'><a href="mcad.html#.signedNormToParam">signedNormToParam</a></li><li data-type='method'><a href="mcad.html#.signedNtoUnsignedN">signedNtoUnsignedN</a></li><li data-type='method'><a href="mcad.html#.unsignedNormToParam">unsignedNormToParam</a></li><li data-type='method'><a href="mcad.html#.unsignedNtoSignedN">unsignedNtoSignedN</a></li></ul></li></ul><h3>Tutorials</h3><ul><li><a href="tutorial-Scheduler-1.html">Scheduler-1</a></li><li><a href="tutorial-Scheduler-2.html">Scheduler-2</a></li><li><a href="tutorial-Scheduler-3.html">Scheduler-3</a></li><li><a href="tutorial-Scheduler-4.html">Scheduler-4</a></li><li><a href="tutorial-Scheduler-5.html">Scheduler-5</a></li></ul>
</nav>

<div id="main">
    
    <h1 class="page-title">mcad.mseg.v1-0.js</h1>
    

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/**
 * @fileOverview Contains the MCAD Multi-Stage Envelope Generator class.
 * @name MCAD MSEG
 * @version 1.0
 */

 /**
 * Constructs a multi-stage envelope generator object.
 * @class
 * @classdesc A multi-stage envelope generator that handles as many stages as needed as well as one release stage. Any Web Audio parameter can be modulated by this object, e.g. frequency, gain, etc.
 * @param {!string} selector              - jQuery selector string to select the element that represents this widget.
 * @param {object} options                - config options to override defaults.
 * @param {number} [options.paramMin=0.0] - minimum parameter value for this widget.
 * @param {number} [options.paramMax=1.0] - maximum parameter value for this widget.
 * @example &lt;caption>MSEG with 300hz to 20khz parameter range&lt;/caption>
 * var adsr = new Mseg({paramMin: 300, paramMax: 20000});
 * @example &lt;caption>MSEG with 0.0 to 1.0 parameter range&lt;/caption>
 * var adsr = new Mseg();
 */
function Mseg(options) {
		
	this._stages = [];
	this._release = [0, 0];
	this._stageLengthInSeconds = 0;
	
	if(options) {
	
		if(options.paramMin) this._paramMin = options.paramMin;
		else this._paramMin = 0.0;
		
		if(options.paramMax) this._paramMax = options.paramMax;
		else this._paramMax = 1.0;
	}
	else {
		this._paramMin = 0.0;
		this._paramMax = 1.0;
	}
}

/** 
 * Adds a stage to the multi-stage envelope. Newly added stages are added to the end of the envelope.
 * @param {object} stage                 - the stage parameters to add.
 * @param {number} stage.value           - normalized parameter value in the {@linkcode [0,1]} range for this stage to reach.
 * @param {number} stage.duration          - duration (in seconds) taken to reach the the stage value.
 * @param {("linear"|"exp")} [stage.type="linear"] - curvature of this stage, either linear or exponential.
 * @example &lt;caption>Creating an attack-decay envelope that rises from {@linkcode 0.0} to {@linkcode 1.0} linearly in 0.25 seconds and back down to {@linkcode 0.0} exponentially over 0.5 seconds&lt;/caption>
 * // Attack-decay envelope for a gain parameter
 * var gainEnv = new Mseg();
 *
 * // Start stage with 0.0 gain
 * gainEnv.addStage({duration: 0.0, value: 0.0});
 *
 * // Attack stage of envelope
 * gainEnv.addStage({duration: 0.25, value: 1.0});
 *
 * // Decay stage of envelope
 * gainEnv.addStage({duration: 0.5, value: 0.0, type: "exp"});
 */

Mseg.prototype.addStage = function(stage) {

	var duration = stage.duration;
	var value = stage.value;
	var type = 0;
	
	if(stage.type) {
		
		if(stage.type == "linear") type = 0;
		else type = 1;
	}
	
	this._stages.push(new Array(duration, value, type));
	this._stageLengthInSeconds += stage.duration;
}

/** 
 * Adds a release stage to the multi-stage envelope. Release stages are triggered on note off and modulate from the current parameter value (depending on what stage has currently been reached, if any) to {@linkcode 0.0}.
 * @param {object} release                 - the stage parameters to add.
 * @param {number} stage.duration          - duration (in seconds) taken to reach {@linkcode 0.0}.
 * @param {("linear"|"exp")} [stage.type="linear"] - curvature of this stage, either linear or exponential.
 * @example &lt;caption>Creating an attack-decay envelope that rises from {@linkcode 0.0} to {@linkcode 1.0} linearly in 0.25 seconds and back down to {@linkcode 0.0} exponentially over 0.5 seconds with a 1 second linear release time&lt;/caption>
 * // Attack-decay envelope for a gain parameter
 * var gainEnv = new Mseg();
 *
 * // Start stage with 0.0 gain
 * gainEnv.addStage({duration: 0.0, value: 0.0});
 *
 * // Attack stage of envelope
 * gainEnv.addStage({duration: 0.25, value: 1.0});
 *
 * // Decay stage of envelope
 * gainEnv.addStage({duration: 0.5, value: 0.0, type: "exp"});
 *
 * // Release stage of envelope
 * gainEnv.addRelease({duration: 1.0});
 */

Mseg.prototype.addRelease = function(release) {

	var type = 0;
	
	if(release.type) {
		
		if(release.type == "linear") type = 0;
		else type = 1;
	}
	
	this._release = new Array(release.duration, type);
}

Mseg.prototype._applyRelease = function(param, when) {

	var value = this._paramMin;
	
	if(this._release[1] == 0) {
		param.linearRampToValueAtTime(value, when + this._release[0]);
	}
	else {
		param.exponentialRampToValueAtTime(value, when + this._release[0]);
	}
	
}

Mseg.prototype.durationOfRelease = function() {
	return this._release[0];
}

/** 
 * Schedules the given Web Audio parameter for modulation by the multi-stage envelope at a the specified time.
 * @param {object} param - the Web Audio parameter to modulate.
 * @param {number} when  - the time to schedule the modulation for.
 * @example &lt;caption>Modulates an oscillator's frequency parameter at the current context time with an MSEG&lt;/caption>
 * pitchEnv.noteOn(oscillator.frequency, context.currentTime);
 * @example &lt;caption>Modulates a gain node's gain parameter for a note shceduled for playback in 1 second's time with an MSEG&lt;/caption>
 * ampEnv.noteOn(masterGain.gain, context.currentTime + 1.0);
 */

Mseg.prototype.noteOn = function(param, when) {

	param.cancelScheduledValues(when);
	param.setValueAtTime(param.value, when);

	var stageTimeAccum = 0;
	
	for (var i = 0; i &lt; this._stages.length; i++) {
			
		var value = mcad.unsignedNormToParam(this._stages[i][1], this._paramMin, this._paramMax);
		var stageDuration = when + stageTimeAccum + this._stages[i][0];
		
		if(this._stages[i][2] == 0) {
			param.linearRampToValueAtTime(value, stageDuration);
		}
		else {
			param.exponentialRampToValueAtTime(value, stageDuration);
		}
		
		stageTimeAccum += this._stages[i][0];
	}
}

/** 
 * Schedules the given Web Audio parameter for modulation by the release stage of a multi-stage envelope at a the specified time. Note that the oscillator's duration must accomodate the duration of the release stage so make sure that oscillators are cued to stop playing at a time in the future after the release stage has finished.
 * @param {object} param - the Web Audio parameter to modulate.
 * @param {number} when  - the time to schedule the modulation for.
 * @example &lt;caption>Applies the release stage of an MSEG to an oscillator's frequency parameter at the current context time&lt;/caption>
 * // Stop the oscillator from playing now with enough time for the release stage to finish
 * oscillator.stop(context.currentTime + pitchEnv.durationOfRelease());
 *
 * // Modulate the oscilaltor's pitch parameter with the release stage of the envelope
 * pitchEnv.noteOff(oscillator.frequency, context.currentTime);
 * @example &lt;caption>Applies the release stage of an MSEG to an oscillator's frequency parameter at the current context time&lt;/caption>
 * // Stop the oscillator from playing in the future with enough time for the release stage to finish
 * oscillator.stop(context.currentTime + ampEnv.durationOfRelease() + 1.0);
 *
 * // Modulate the gain parameter with the release stage of the envelope
 * ampEnv.noteOff(masterGain.gain, context.currentTime + 1.0);
 */

Mseg.prototype.noteOff = function(param, when) {

	param.cancelScheduledValues(when);
	param.setValueAtTime(param.value, when);
	
	this._applyRelease(param, when);
	
}

Mseg.prototype.noteOnAndOff = function(param, when, duration) {

	this.noteOn(param, when);
	this._applyRelease(param, when + duration);	
	return duration + this._release[0];
}</code></pre>
        </article>
    </section>




</div>

<br class="clear">

<footer>
    Documentation generated at Tue Apr 19 2016 23:48:29 GMT+0100 (GMT Daylight Time)
</footer>

<script>prettyPrint();</script>
<script src="scripts/linenumber.js"></script>
</body>
</html>
